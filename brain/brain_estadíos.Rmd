---
title: "brain_estad√≠os"
author: "Elena Maroto Rica"
date: "2025-03-07"
output: html_document
---

```{r, results='hide', warning=FALSE, message=F, include=FALSE, echo=F}
library(BiocManager)
library(BiocManager)
library(org.Hs.eg.db)
#Incluir KnowSeq y las funciones proporcionadas 
require(KnowSeq)
source("convert_to_counts.R")
source("geneOntologyEnrichment_updated.R")
source("knowseqReport_updated.R")
require("e1071")
require(CORElearn)
require("caret")
require("praznik")
library(caret)
#install.packages("jsonlite")
library('jsonlite')
```

```{r}
load(file='samples')

load(file='samples_astrocytoma')
samples$Sample.Type[samples$File.ID %in% samples_astrocytoma$File.ID] <- 'astrocytoma'

load(file='samples_mixed')
samples$Sample.Type[samples$File.ID %in% samples_mixed$File.ID] <- 'mixed_glioma'

load(file='samples_oligodendroglioma')
samples$Sample.Type[samples$File.ID %in% samples_oligodendroglioma$File.ID] <- 'oligodendroglioma'
```

```{r}
df_clinical <- fromJSON("clinical.cart.2025-03-06.json")
```

```{r}
df_clinical$tumor_grade <- sapply(df_clinical$diagnoses, function(x) x$tumor_grade)
```

```{r}
df_clinical$tumor_grade[grepl('G2', df_clinical$tumor_grade)] <- 'G2'
df_clinical$tumor_grade[grepl('G3', df_clinical$tumor_grade)] <- 'G3'
```

```{r}
astrocytoma_G2 <- df_clinical[df_clinical$submitter_id %in% samples_astrocytoma$Case.ID & 
                              grepl('G2', df_clinical$tumor_grade), ]
astrocytoma_G3 <- df_clinical[df_clinical$submitter_id %in% samples_astrocytoma$Case.ID & 
                              grepl('G3', df_clinical$tumor_grade), ]

oligodendroglioma_G2 <- df_clinical[df_clinical$submitter_id %in% samples_oligodendroglioma$Case.ID & 
                              grepl('G2', df_clinical$tumor_grade), ]
oligodendroglioma_G3 <- df_clinical[df_clinical$submitter_id %in% samples_oligodendroglioma$Case.ID & 
                              grepl('G3', df_clinical$tumor_grade), ]
```

```{r}
samples_astrocytoma_estadios <- samples[samples$Case.ID %in% astrocytoma_G2$submitter_id | 
                                        samples$Case.ID %in% astrocytoma_G3$submitter_id, ]

samples_astrocytoma_estadios$tumor_grade <- 0

samples_astrocytoma_estadios$tumor_grade[samples_astrocytoma_estadios$Case.ID %in% astrocytoma_G2$submitter_id] <- 'G2'
samples_astrocytoma_estadios$tumor_grade[samples_astrocytoma_estadios$Case.ID %in% astrocytoma_G3$submitter_id] <- 'G3'

save(samples_astrocytoma_estadios, file ='samples_astrocytoma_estadios')

#########################

samples_oligodendroglioma_estadios <- samples[samples$Case.ID %in% oligodendroglioma_G2$submitter_id | 
                                        samples$Case.ID %in% oligodendroglioma_G3$submitter_id, ]

samples_oligodendroglioma_estadios$tumor_grade <- 0

samples_oligodendroglioma_estadios$tumor_grade[samples_oligodendroglioma_estadios$Case.ID %in% oligodendroglioma_G2$submitter_id] <- 'G2'
samples_oligodendroglioma_estadios$tumor_grade[samples_oligodendroglioma_estadios$Case.ID %in% oligodendroglioma_G3$submitter_id] <- 'G3'

save(samples_oligodendroglioma_estadios, file='samples_oligodendroglioma_estadios')
```

